C51 COMPILER V9.01   KEY                                                                   05/13/2021 09:27:55 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE KEY
OBJECT MODULE PLACED IN .\Objects\KEY.obj
COMPILER INVOKED BY: D:\Keil_v5\C51\BIN\C51.EXE ..\BSP\BSP_KEY\KEY.C LARGE WARNINGLEVEL(1) OPTIMIZE(8,SPEED) BROWSE INCD
                    -IR(..\USER;..\SYS;..\BSP\BSP_485;..\BSP\BSP_ADC;..\BSP\BSP_KEY;..\BSP\BSP_OLED_IIC;..\APP;..\BSP\BSP_IO) DEBUG OBJECTEXT
                    -END PRINT(.\Listings\KEY.lst) TABS(2) OBJECT(.\Objects\KEY.obj)

line level    source

   1          /*
   2           * @Author: your name
   3           * @Date: 2021-04-30 09:38:30
   4           * @LastEditTime: 2021-05-13 09:27:38
   5           * @LastEditors: Please set LastEditors
   6           * @Description: In User Settings Edit
   7           * @FilePath: \AirPressControl\BSP\BSP_KEY\KEY.C
   8           */
   9          
  10          #include "CH551.H"                                                          
  11          #include "Debug.H"
  12          #include "KEY.H"
  13          
  14          #pragma  NOAREGS
  15          
  16          sbit key1=P1^1;
  17          sbit key2=P1^4;
  18          sbit key3=P1^5;
  19          
  20          UINT8 KeyState[3] = {1,1,1};     
  21          unsigned long  KeyDownTime[3]= {0, 0, 0};
  22          
  23          
  24          UINT8 GetKeyStation(UINT8 i)
  25          {
  26   1        return  KeyState[i];
  27   1      }
  28          UINT8 KeyPressLong(UINT8 i)
  29          {
  30   1        UINT8 PressLong;
  31   1        if(KeyDownTime[i]>PressTime)
  32   1        {
  33   2        PressLong=1;
  34   2        }
  35   1        else
  36   1        {
  37   2        PressLong=0;
  38   2        }
  39   1      return PressLong;
  40   1      }
  41          
  42          
  43          UINT8 T0RH = 0; 
  44          UINT8 T0RL = 0; 
  45          
  46          void ConfigT0(UINT8 ms)
  47          {
  48   1          unsigned long tmp = 0;
  49   1      
  50   1        tmp = 12000000/12;
  51   1        tmp = (tmp * ms)/1000;
  52   1        tmp = 65536 - tmp;
  53   1        tmp = tmp + 1;
C51 COMPILER V9.01   KEY                                                                   05/13/2021 09:27:55 PAGE 2   

  54   1          T0RH = (UINT8)(tmp >> 8);
  55   1        T0RL = (UINT8)tmp;
  56   1      
  57   1        TMOD = ( TMOD & ~( bT0_GATE | bT0_CT | bT0_M1 ) ) | bT0_M0;
  58   1        TH0 = T0RH;
  59   1        TL0 = T0RL;
  60   1        TF0 = 0;
  61   1        ET0 = 1;
  62   1        TR0 = 1;
  63   1      }
  64          
  65          void KeyScan()
  66          {
  67   1        UINT8 i;
  68   1        static UINT8 keybuffer[3] = {0xFF,0xFF,0xFF};
  69   1      
  70   1        keybuffer[0] = (keybuffer[0] <<1) | key1;
  71   1        keybuffer[1] = (keybuffer[1] <<1) | key2;
  72   1        keybuffer[2] = (keybuffer[2] <<1) | key3;
  73   1      
  74   1        for(i=0;i<3;i++)
  75   1        {
  76   2          if((keybuffer[i] & 0x0F) == 0x00)
  77   2          {
  78   3            KeyState[i] = 0;
  79   3            if(i>=3)
  80   3                break;
  81   3            KeyDownTime[i] += 10;  
  82   3          }
  83   2          else if((keybuffer[i] & 0x0F) == 0x0F)
  84   2          {
  85   3            KeyState[i] = 1;
  86   3            if(i>=3)
  87   3                break;
  88   3            KeyDownTime[i] = 0;  
  89   3          }
  90   2        } 
  91   1      }
  92          
  93          void InterruptTimer0() interrupt INT_NO_TMR0 using 2
  94          {
  95   1        TH0 = T0RH;
  96   1        TL0 = T0RL;
  97   1        KeyScan(); 
  98   1      }
  99          
 100          void KeyInit()
 101          {
 102   1        ConfigT0(100); 
 103   1        Port1Cfg(3,1);//key1
 104   1        Port1Cfg(3,4);//key2
 105   1        Port1Cfg(3,5);//key3
 106   1        key1 = 1;
 107   1        key2 = 1;
 108   1        key3 = 1;
 109   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    543    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =     20       6
C51 COMPILER V9.01   KEY                                                                   05/13/2021 09:27:55 PAGE 3   

   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
